
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Optimizing Solution to Project Euler Problem 12 - Lisa Hamm</title>
  <meta name="author" content="Lisa Hamm">

  
  <meta name="description" content="Optimizing Solution to Project Euler Problem 12 written Feb 2nd, 2015 12:00 am While working on the Project Euler problems, I came across one ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lisahamm.github.io/blog/2015/02/02/optimizing-solution-to-project-euler-problem-12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Lisa Hamm" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  

</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        <h1>Optimizing Solution to Project Euler Problem 12</h1>
        <div class="meta">
          written 





<time class='entry-date' datetime='2015-02-02'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>12:00 am</span></time>
          


        </div>
        <p>While working on the Project Euler problems, I came across one (Problem 12) that was taking a very long time to compute. In this blog post, I will go through the initial steps I took to solve the problem, followed by the steps I took to optimize the solution. Problem 12 reads:</p>

<p>The sequence of triangular numbers is generated by adding the natural numbers. So the 7th triangular number would be 1 + 2 + 3 + 4 + 5 + 6 + 7 = 28. The first ten terms would be: 1, 3, 6, 10, 15, 21, 28, 36, 45, 55, &hellip;
Let us list the factors of the first seven triangular numbers:<br>
 1: 1<br>
 3: 1,3<br>
 6: 1,2,3,6<br>
10: 1,2,5,10<br>
15: 1,3,5,15<br>
21: 1,3,7,21<br>
28: 1,2,4,7,14,28<br>
We can see that 28 is the first triangular number to have over five divisors.
What is the value of the first triangular number to have over five hundred divisors?</p>

<!--more-->


<h3>Getting Started</h3>

<p>In order to tackle the problem, I first wrote a method to calculate the number of divisors of a given number. If the parameter was 1, the method would return 1 as the number of divisors. For all other cases, the method would search through all numbers between 1 and half of the dividend to evaluate if the dividend was evenly divisible by any of the numbers in the range. Each number in the range that divided evenly into the dividend was thus counted as a factor.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">number_of_divisors</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">integer</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>  <span class="p">((</span><span class="mi">1</span><span class="o">.</span><span class="n">.integer</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">find_all</span> <span class="p">{</span><span class="o">|</span><span class="n">divisor</span><span class="o">|</span> <span class="n">integer</span> <span class="o">%</span> <span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">+</span> <span class="o">[</span><span class="n">integer</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, I needed a method to iterate over triangular numbers until it found one with over 500 divisors. The method would need to keep track of the current triangular number and the current index of the triangular number, as well as calculate each triangular number. The method would also need to evaluate the number of divisors for each triangular number and return the first triangular number with over 500 divisors.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="n">desired_number_of_divisors</span><span class="p">)</span>
</span><span class='line'>  <span class="n">triangular_number</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">triangular_number</span> <span class="o">+=</span> <span class="n">index</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">triangular_number</span> <span class="k">if</span> <span class="n">number_of_divisors</span><span class="p">(</span><span class="n">triangular_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">desired_number_of_divisors</span>
</span><span class='line'>    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since I was using Test Driven Development to solve the problem, my tests for this method started out with small numbers of divisors and slowly incremented to larger numbers of divisors:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 1 divisor&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">3</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 2 divisors&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">6</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 5 divisors&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">28</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 50 divisors&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">25200</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 100 divisors&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">73920</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once all of the above tests were passing, I tested for the first triangular number to have over 200 divisors:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;returns the first triangular number to have over 200 divisors&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">expect</span><span class="p">(</span><span class="n">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">2031120</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was the first test to take more than 2 seconds to run. In fact, it took around 2 minutes to run. When I finally attempted to calculate the answer to the problem (requiring the number of divisors to be upped to 500), I reached a standstill. The process ran for what seemed like an eternity (1345 minutes and 37 seconds to be exact, which is roughly 22.5 hours) before returning the correct answer.</p>

<h3>Optimization</h3>

<p>While the calculation was running, I began to try to optimize the algorithm. In order to figure out where the slowdown was occurring, I added code to print out triangular numbers each time the number of divisors incremented.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">triangular_number_with_over_n_divisors</span><span class="p">(</span><span class="n">desired_number_of_divisors</span><span class="p">)</span>
</span><span class='line'>  <span class="n">triangular_number</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">divisors</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">triangular_number</span> <span class="o">+=</span> <span class="n">index</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">number_of_divisors</span><span class="p">(</span><span class="n">triangular_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">divisors</span>
</span><span class='line'>      <span class="n">divisors</span> <span class="o">=</span> <span class="n">number_of_divisors</span><span class="p">(</span><span class="n">triangular_number</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;index: </span><span class="si">#{</span><span class="n">index</span><span class="si">}</span><span class="s2">, triangular number: </span><span class="si">#{</span><span class="n">triangular_number</span><span class="si">}</span><span class="s2">,</span>
</span><span class='line'><span class="s2">      number of divisors: </span><span class="si">#{</span><span class="n">divisors</span><span class="si">}</span><span class="s2">, current time: </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">triangular_number</span> <span class="k">if</span> <span class="n">number_of_divisors</span><span class="p">(</span><span class="n">triangular_number</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">desired_number_of_divisors</span>
</span><span class='line'>    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this addition, I figured out the process was held up after the 5,984th triangular number, 17,907,120, which has a total of 480 divisors. At this point, I began to explore options for optimizing the algorithm. First, I decided to examine the code to pinpoint the lines that may have been major contributors to the lag time. This led me straight to the number_of_divisors method which was running through each number between 1 and ½ of the number to check if the dividend was evenly divisible by each. For a small number, this might not be such a problem, but for the larger numbers dealt with in this exercise, this results in having to repeatedly calculate the modulo for millions of divisors. The first triangular number with over 500 divisors is over 76 million. Using the current algorithm, over 38 million moduli would need to be calculated for just the last triangular number alone. Considering over 12,000 triangular numbers would need to be looped through before reaching the first one with over 500 divisors, this algorithm was significantly slowing down the run time. What could be done in order to optimize this? Could anything be done?</p>

<p>Thankfully, the answer is yes! There is a handy equation to calculate the number of factors of an integer using its prime factorization. Every integer, N, is the product of prime numbers. This can be expressed using exponential notation where N is an integer, x, y, and z are prime factors of N, and a, b, and c are integer powers of the primes:</p>

<p> N = x<sup>a</sup>  * y<sup>b</sup> * z<sup>c</sup> &hellip;</p>

<p>Since every integer is the product of powers of prime numbers, we can use the powers of a number’s primes to find the number of possible combinations. The following equation will give us the number of factors of an integer:
(a+1)(b+1)(c+1) &hellip;</p>

<p>Consider the following example:</p>

<p>N = 36<br>
36 has 9 factors = 1, 2, 3, 4, 6, 9, 12, 18, 36<br></p>

<p>Let’s break this number down into its prime factors:<br>
36 = 2 * 18<br>
36 = 2 * 2 * 9<br>
36 = 2 * 2 * 3 * 3<br></p>

<p>Now we can write the prime factorization of 36 in exponential notation:<br>
36 = 2<sup>2</sup> * 3<sup>2</sup></p>

<p>Using the equation from above ((a+1)(b+1)), we can calculate the number of factors of 36 without actually having to find all of the factors:</p>

<p>Number of factors = (2+1) * (2+1)<br>
Number of factors = 9</p>

<h3>Prime Factorization</h3>

<p>I needed to figure out an efficient way to find an integer’s prime factorization so I could utilize this equation for the purposes of this Project Euler problem. I decided to create a Prime Factors module that would include a method to implement this formula. I also watched a video of the <a href="http://vimeo.com/7762511">Prime Factors kata</a> to see how others have tackled this implementation. The Prime Factors module ended up containing the following methods:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">prime_factors_of</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
</span><span class='line'>  <span class="n">prime_factors</span><span class="p">,</span> <span class="n">divisor</span> <span class="o">=</span> <span class="o">[]</span><span class="p">,</span> <span class="mi">1</span>
</span><span class='line'>  <span class="k">while</span> <span class="n">integer</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">divisor</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="n">prime_factors</span> <span class="o">&lt;&lt;</span> <span class="n">divisor</span> <span class="ow">and</span> <span class="n">integer</span><span class="o">/=</span><span class="n">divisor</span> <span class="k">while</span> <span class="n">integer</span> <span class="o">%</span> <span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>    <span class="n">divisor</span> <span class="o">=</span> <span class="n">integer</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">divisor</span> <span class="o">&gt;</span> <span class="no">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">prime_factors</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">counts_of_prime_factors</span><span class="p">(</span><span class="n">prime_factors</span><span class="p">)</span>
</span><span class='line'>  <span class="n">prime_factors</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">prime_factor</span><span class="o">|</span> <span class="n">prime_factors</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">prime_factor</span><span class="p">)}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once I incorporated the newly created module’s methods in the original number_of_divisors method, the speed of the calculation was dramatically improved. The answer to the problem was returned in under 2 seconds!  Here’s my updated method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">number_of_divisors</span><span class="p">(</span><span class="n">integer</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">integer</span> <span class="o">==</span> <span class="mi">1</span>
</span><span class='line'>  <span class="n">counts_of_prime_factors</span><span class="p">(</span><span class="n">prime_factors_of</span><span class="p">(</span><span class="n">integer</span><span class="p">))</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">count</span><span class="o">|</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="ss">:*</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can find my entire solution on my <a href="https://github.com/lisahamm/project_euler_tdd/blob/master/lib/problem_twelve.rb">github</a>.</p>

<h3>Lessons Learned</h3>

<p>Working through this problem taught me a lot. I learned about Big O Notation when my mentor helped me examine the order of the algorithms involved. I experienced firsthand how the order of an algorithm comes into play when working with numbers of a large magnitude.</p>


        <hr class="divider-short"/>

        
      </div>
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2015/01/22/rubys-yield-keyword/" title="Previous Post: Ruby's Yield Keyword">&laquo; Previous: Ruby&#8217;s Yield Keyword</a>
        

        
          <a class="pull-right" href="/blog/2015/02/12/word-wrap-kata-in-ruby/" title="Next Post: Word Wrap Kata in Ruby">Next: Word Wrap Kata in Ruby &raquo;</a>
        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/lisahamm11"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/lisahamm"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
  </div>
</div>

<div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a>.</h4>
</div>


    </div>
  </div>
</footer>

    
  </body>
</html>
